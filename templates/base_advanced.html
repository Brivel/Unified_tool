<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#0d1117">
    <title>{% block title %}PROTEGIO - Advanced{% endblock %}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        /* ========== DARK MODE THEMES ========== */
        :root {
            --color-midnight-bg: #0a0e27;
            --color-midnight-card: #151a3f;
            --color-midnight-border: #1f2555;
            --color-midnight-text: #e0e4ff;
            --color-midnight-muted: #6b7280;
            
            --color-charcoal-bg: #0d1117;
            --color-charcoal-card: #161b22;
            --color-charcoal-border: #30363d;
            --color-charcoal-text: #c9d1d9;
            --color-charcoal-muted: #8b949e;
            
            --color-slate-bg: #1a1f2e;
            --color-slate-card: #242d3d;
            --color-slate-border: #3a4556;
            --color-slate-text: #d4d8e1;
            --color-slate-muted: #7e8a9a;
            
            --color-onyx-bg: #0f1117;
            --color-onyx-card: #1a1f26;
            --color-onyx-border: #2d3139;
            --color-onyx-text: #cdd9e5;
            --color-onyx-muted: #7d8590;
            
            /* Default theme: Charcoal */
            --bg-main: var(--color-charcoal-bg);
            --bg-card: var(--color-charcoal-card);
            --text-main: var(--color-charcoal-text);
            --text-muted: var(--color-charcoal-muted);
            --border-color: var(--color-charcoal-border);
            
            --accent-primary: #58a6ff;
            --accent-success: #3fb950;
            --accent-danger: #f26161;
            --accent-warning: #ffc107;
        }

        /* Dark Mode Theme Variants */
        body.theme-midnight {
            --bg-main: var(--color-midnight-bg);
            --bg-card: var(--color-midnight-card);
            --text-main: var(--color-midnight-text);
            --text-muted: var(--color-midnight-muted);
            --border-color: var(--color-midnight-border);
        }

        body.theme-slate {
            --bg-main: var(--color-slate-bg);
            --bg-card: var(--color-slate-card);
            --text-main: var(--color-slate-text);
            --text-muted: var(--color-slate-muted);
            --border-color: var(--color-slate-border);
        }

        body.theme-onyx {
            --bg-main: var(--color-onyx-bg);
            --bg-card: var(--color-onyx-card);
            --text-main: var(--color-onyx-text);
            --text-muted: var(--color-onyx-muted);
            --border-color: var(--color-onyx-border);
        }

        * { transition: background-color 0.3s ease, color 0.3s ease; }

        /* ========== GLOBAL STYLES ========== */
        body {
            background: var(--bg-main);
            color: var(--text-main);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow-x: hidden;
        }

        /* ========== SIDEBAR NAVIGATION ========== */
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            width: 280px;
            background: var(--bg-card);
            border-right: 1px solid var(--border-color);
            overflow-y: auto;
            padding: 20px 0;
            z-index: 1000;
            transition: transform 0.3s ease;
        }

        .sidebar.collapsed {
            transform: translateX(-280px);
        }

        .sidebar-logo {
            padding: 20px 15px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 24px;
            font-weight: bold;
            color: var(--accent-primary);
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 20px;
        }

        .sidebar-nav {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .sidebar-nav-item {
            padding: 0;
            margin: 5px 10px;
        }

        .sidebar-nav-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 15px;
            color: var(--text-main);
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s ease;
            position: relative;
        }

        .sidebar-nav-link:hover {
            background: rgba(88, 166, 255, 0.1);
            color: var(--accent-primary);
            transform: translateX(5px);
        }

        .sidebar-nav-link.active {
            background: rgba(88, 166, 255, 0.2);
            color: var(--accent-primary);
            border-left: 3px solid var(--accent-primary);
            padding-left: 12px;
        }

        .sidebar-nav-link i {
            width: 20px;
            text-align: center;
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 240px;
            }
        }

        @media (max-width: 576px) {
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
                border-right: none;
                border-bottom: 1px solid var(--border-color);
            }

            .sidebar.collapsed {
                transform: translateY(-100%);
            }
        }

        /* ========== MAIN CONTENT ========== */
        .main-wrapper {
            margin-left: 280px;
            padding: 20px;
            min-height: 100vh;
        }

        @media (max-width: 576px) {
            .main-wrapper {
                margin-left: 0;
                padding: 10px;
            }
        }

        /* ========== TOP NAVBAR ========== */
        .topbar {
            background: var(--bg-card);
            border-bottom: 1px solid var(--border-color);
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-radius: 8px;
        }

        .topbar-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .sidebar-toggle {
            background: none;
            border: none;
            color: var(--text-main);
            cursor: pointer;
            font-size: 20px;
            transition: all 0.3s ease;
        }

        .sidebar-toggle:hover {
            color: var(--accent-primary);
            transform: scale(1.1);
        }

        .topbar-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        /* ========== BREADCRUMB ========== */
        .breadcrumb {
            background: transparent;
            padding: 0;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .breadcrumb-item {
            color: var(--text-muted);
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .breadcrumb-item:hover {
            color: var(--accent-primary);
        }

        .breadcrumb-item.active {
            color: var(--text-main);
            font-weight: 600;
        }

        .breadcrumb-separator {
            color: var(--border-color);
            margin: 0 8px;
        }

        /* ========== CARDS WITH ANIMATIONS ========== */
        .card, .card-advanced {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            transition: all 0.4s cubic-bezier(0.23, 1, 0.320, 1);
            overflow: hidden;
            position: relative;
        }

        .card:hover, .card-advanced:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 40px rgba(88, 166, 255, 0.15);
            border-color: var(--accent-primary);
        }

        .card-advanced::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--accent-primary), transparent);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .card-advanced:hover::before {
            opacity: 1;
        }

        /* ========== BADGE COLORS ========== */
        .badge-critical { background: #f26161; color: white; }
        .badge-high { background: #f0883e; color: white; }
        .badge-medium { background: #ffc107; color: #000; }
        .badge-low { background: #3fb950; color: white; }
        .badge-info { background: #58a6ff; color: white; }

        /* ========== FORMS ========== */
        .form-control, .form-select {
            background: var(--bg-main);
            color: var(--text-main);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .form-control:focus, .form-select:focus {
            background: var(--bg-main);
            color: var(--text-main);
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 0.2rem rgba(88, 166, 255, 0.15);
        }

        /* ========== BUTTONS ========== */
        .btn {
            border-radius: 8px;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .btn-primary {
            background: var(--accent-primary);
            border: none;
        }

        .btn-primary:hover {
            background: #388bfd;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(88, 166, 255, 0.3);
        }

        .btn-success {
            background: var(--accent-success);
            border: none;
        }

        .btn-success:hover {
            background: #2d8f3e;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: var(--accent-danger);
            border: none;
        }

        .btn-danger:hover {
            background: #e05555;
            transform: translateY(-2px);
        }

        /* ========== TABLES ========== */
        .table {
            color: var(--text-main);
        }

        .table th {
            border-color: var(--border-color);
            background: rgba(88, 166, 255, 0.1);
            font-weight: 600;
        }

        .table td {
            border-color: var(--border-color);
            vertical-align: middle;
        }

        .table tbody tr {
            transition: background-color 0.3s ease;
        }

        .table tbody tr:hover {
            background: rgba(88, 166, 255, 0.08);
        }

        /* ========== THEME SWITCHER ========== */
        .theme-switcher {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .theme-btn {
            width: 28px;
            height: 28px;
            border: 2px solid var(--border-color);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            background: transparent;
            color: var(--text-muted);
        }

        .theme-btn:hover {
            border-color: var(--accent-primary);
            color: var(--accent-primary);
        }

        .theme-btn.active {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
            color: var(--bg-main);
        }

        /* ========== ANIMATIONS ========== */
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .animate-in {
            animation: slideInUp 0.5s ease-out;
        }

        .animate-pulse {
            animation: pulse 2s infinite;
        }

        .animate-sidebar {
            animation: slideInLeft 0.4s ease-out;
        }

        /* ========== RESPONSIVE GRID ========== */
        .grid-responsive {
            display: grid;
            gap: 15px;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        }

        @media (max-width: 768px) {
            .grid-responsive {
                grid-template-columns: 1fr;
            }
        }

        /* ========== TERMINAL MODE ========== */
        .terminal {
            background: var(--bg-main);
            border: 1px solid var(--accent-primary);
            border-radius: 8px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            color: var(--accent-primary);
            height: 400px;
            overflow-y: auto;
            position: relative;
        }

        .terminal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }

        .terminal-title {
            color: var(--text-main);
            font-weight: bold;
            font-size: 14px;
        }

        .terminal-controls {
            display: flex;
            gap: 8px;
        }

        .terminal-btn {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
        }

        .terminal-btn.close { background: #f26161; }
        .terminal-btn.minimize { background: #ffc107; }
        .terminal-btn.maximize { background: #3fb950; }

        .terminal-output {
            font-size: 13px;
            line-height: 1.6;
        }

        .terminal-line {
            white-space: pre-wrap;
            word-wrap: break-word;
            margin-bottom: 5px;
        }

        .terminal-prompt {
            color: var(--accent-warning);
        }

        .terminal-input {
            width: 100%;
            background: transparent;
            border: none;
            color: var(--accent-primary);
            font-family: 'Courier New', monospace;
            font-size: 13px;
            margin-top: 10px;
            padding: 0;
        }

        .terminal-input:focus {
            outline: none;
        }

        .cursor {
            display: inline-block;
            width: 2px;
            height: 1em;
            background: var(--accent-primary);
            animation: blink 1s infinite;
            margin-left: 2px;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        /* ========== MOBILE FIRST ========== */
        @media (max-width: 576px) {
            .topbar {
                flex-direction: column;
                gap: 12px;
                align-items: flex-start;
            }

            .topbar-right {
                width: 100%;
                justify-content: space-between;
            }

            .grid-responsive {
                grid-template-columns: 1fr;
            }

            .card, .card-advanced {
                margin-bottom: 10px;
            }

            .terminal {
                height: 300px;
            }
        }

        /* ========== SCROLLBAR ========== */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-main);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--accent-primary);
        }
    </style>
</head>
<body class="theme-charcoal">
    <!-- SIDEBAR NAVIGATION -->
    <aside class="sidebar animate-sidebar">
        <div class="sidebar-logo">
            <i class="fa-solid fa-shield"></i> PROTEGIO
        </div>
        <ul class="sidebar-nav">
            <li class="sidebar-nav-item">
                <a href="/dashboard/" class="sidebar-nav-link {% if 'dashboard' in request.path %}active{% endif %}">
                    <i class="fa-solid fa-chart-line"></i> Dashboard
                </a>
            </li>
            <li class="sidebar-nav-item">
                <a href="/integrations/" class="sidebar-nav-link {% if 'integrations' in request.path and 'nuclei' not in request.path and 'ports' not in request.path and 'ssl' not in request.path and 'api' not in request.path and 'cve' not in request.path and 'reports' not in request.path %}active{% endif %}">
                    <i class="fa-solid fa-network-wired"></i> Int√©grations
                </a>
            </li>
            <li class="sidebar-nav-item">
                <a href="/integrations/nuclei/" class="sidebar-nav-link {% if 'nuclei' in request.path %}active{% endif %}">
                    <i class="fa-solid fa-virus"></i> Nuclei
                </a>
            </li>
            <li class="sidebar-nav-item">
                <a href="/integrations/ports/" class="sidebar-nav-link {% if 'ports' in request.path %}active{% endif %}">
                    <i class="fa-solid fa-sitemap"></i> Port Scanner
                </a>
            </li>
            <li class="sidebar-nav-item">
                <a href="/integrations/ssl/" class="sidebar-nav-link {% if 'ssl' in request.path %}active{% endif %}">
                    <i class="fa-solid fa-lock"></i> SSL/TLS
                </a>
            </li>
            <li class="sidebar-nav-item">
                <a href="/integrations/api-security/" class="sidebar-nav-link {% if 'api-security' in request.path %}active{% endif %}">
                    <i class="fa-solid fa-shield"></i> API Security
                </a>
            </li>
            <li class="sidebar-nav-item">
                <a href="/integrations/cve/" class="sidebar-nav-link {% if 'cve' in request.path %}active{% endif %}">
                    <i class="fa-solid fa-flask-vial"></i> CVE Lookup
                </a>
            </li>
            <li class="sidebar-nav-item">
                <a href="/integrations/reports/" class="sidebar-nav-link {% if 'reports' in request.path %}active{% endif %}">
                    <i class="fa-solid fa-file-pdf"></i> Rapports
                </a>
            </li>
            
            <!-- SEPARATOR -->
            <li style="margin: 15px 0; border-bottom: 1px solid var(--border-color);"></li>
            
            <!-- RECONNAISSANCE -->
            <li class="sidebar-nav-item" style="padding-left: 15px;">
                <small style="color: var(--text-muted); text-transform: uppercase; font-size: 11px; font-weight: bold;">üîç Reconnaissance</small>
            </li>
            <li class="sidebar-nav-item">
                <a href="/protegioTools/" class="sidebar-nav-link {% if 'protegioTools' in request.path %}active{% endif %}">
                    <i class="fa-solid fa-address-card"></i> Whois
                </a>
            </li>
            <li class="sidebar-nav-item">
                <a href="/checker/" class="sidebar-nav-link {% if 'checker' in request.path %}active{% endif %}">
                    <i class="fa-solid fa-magnifying-glass"></i> Whatsmyname
                </a>
            </li>
            <li class="sidebar-nav-item">
                <a href="/dns_tool/" class="sidebar-nav-link {% if 'dns_tool' in request.path %}active{% endif %}">
                    <i class="fa-solid fa-globe"></i> NsLookup
                </a>
            </li>
            
            <!-- SCANNING -->
            <li class="sidebar-nav-item" style="padding-left: 15px; margin-top: 15px;">
                <small style="color: var(--text-muted); text-transform: uppercase; font-size: 11px; font-weight: bold;">‚ö° Scanning</small>
            </li>
            <li class="sidebar-nav-item">
                <a href="/scanner/" class="sidebar-nav-link {% if 'scanner' in request.path %}active{% endif %}">
                    <i class="fa-solid fa-wave-square"></i> OWASP-ZAP
                </a>
            </li>
            <li class="sidebar-nav-item">
                <a href="/intruder/" class="sidebar-nav-link {% if 'intruder' in request.path %}active{% endif %}">
                    <i class="fa-solid fa-user-secret"></i> Burp-Suite
                </a>
            </li>
            <li class="sidebar-nav-item">
                <a href="/perforNet/" class="sidebar-nav-link {% if 'perforNet' in request.path %}active{% endif %}">
                    <i class="fa-solid fa-bolt"></i> PerforNet
                </a>
            </li>
        </ul>
    </aside>

    <!-- MAIN CONTENT -->
    <div class="main-wrapper">
        <!-- TOPBAR -->
        <div class="topbar">
            <div class="topbar-left">
                <button class="sidebar-toggle" id="sidebarToggle">
                    <i class="fa-solid fa-bars"></i>
                </button>
            </div>
            <div class="topbar-right">
                <div class="theme-switcher">
                    <button class="theme-btn active" data-theme="charcoal" title="Charcoal">C</button>
                    <button class="theme-btn" data-theme="midnight" title="Midnight">M</button>
                    <button class="theme-btn" data-theme="slate" title="Slate">S</button>
                    <button class="theme-btn" data-theme="onyx" title="Onyx">O</button>
                </div>
                <button class="btn btn-outline-secondary btn-sm" id="terminalToggle" title="Terminal Mode">
                    <i class="fa-solid fa-terminal"></i>
                </button>
            </div>
        </div>

        <!-- BREADCRUMB -->
        <nav class="breadcrumb">
            {% block breadcrumb %}
            <a class="breadcrumb-item" href="/"><i class="fa-solid fa-house"></i> Accueil</a>
            <span class="breadcrumb-separator"><i class="fa-solid fa-chevron-right"></i></span>
            <span class="breadcrumb-item active">{% block page_name %}PROTEGIO{% endblock %}</span>
            {% endblock %}
        </nav>

        <!-- PAGE CONTENT -->
        <div class="content-area animate-in">
            {% block content %}{% endblock %}
        </div>

        <!-- TERMINAL MODE (Hidden by default) -->
        <div id="terminalModal" style="display: none; position: fixed; bottom: 0; right: 0; width: 600px; max-width: 90%; max-height: 500px; z-index: 2000;">
            <div class="terminal">
                <div class="terminal-header">
                    <div class="terminal-title">PROTEGIO Terminal</div>
                    <div class="terminal-controls">
                        <button class="terminal-btn minimize"></button>
                        <button class="terminal-btn maximize"></button>
                        <button class="terminal-btn close" onclick="document.getElementById('terminalModal').style.display='none'"></button>
                    </div>
                </div>
                <div class="terminal-output" id="terminalOutput"></div>
                <div>
                    <span class="terminal-prompt">user@protegio:~$</span>
                    <input type="text" class="terminal-input" id="terminalInput" placeholder="Taper une commande..." autocomplete="off">
                    <span class="cursor"></span>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // ========== SIDEBAR TOGGLE ==========
        const sidebarToggle = document.getElementById('sidebarToggle');
        const sidebar = document.querySelector('.sidebar');

        sidebarToggle?.addEventListener('click', () => {
            sidebar.classList.toggle('collapsed');
        });

        // ========== THEME SWITCHER ==========
        const themeButtons = document.querySelectorAll('.theme-btn');
        const body = document.body;

        themeButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                const theme = btn.dataset.theme;
                themeButtons.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                
                body.classList.remove('theme-charcoal', 'theme-midnight', 'theme-slate', 'theme-onyx');
                body.classList.add(`theme-${theme}`);
                
                localStorage.setItem('protegio-theme', theme);
            });
        });

        // Load saved theme
        const savedTheme = localStorage.getItem('protegio-theme') || 'charcoal';
        const themeBtn = document.querySelector(`[data-theme="${savedTheme}"]`);
        if (themeBtn) themeBtn.click();

        // ========== TERMINAL MODE ==========
        const terminalToggle = document.getElementById('terminalToggle');
        const terminalModal = document.getElementById('terminalModal');
        const terminalInput = document.getElementById('terminalInput');
        const terminalOutput = document.getElementById('terminalOutput');

        const terminalCommands = {
            'help': 'Commands: status, scan, target, clear, help',
            'status': 'PROTEGIO v1.0 - Running\n‚úì Nuclei Scanner: Active\n‚úì Port Scanner: Active\n‚úì SSL Checker: Active\n‚úì CVE Database: Synced',
            'scan': 'Type: scan <target> [options]\nExample: scan example.com --deep',
            'target': 'Current target: Not set\nUsage: target <domain|ip>',
            'clear': '',
        };

        terminalToggle?.addEventListener('click', () => {
            terminalModal.style.display = terminalModal.style.display === 'none' ? 'block' : 'none';
            if (terminalModal.style.display === 'block') {
                terminalInput.focus();
            }
        });

        terminalInput?.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                const command = terminalInput.value.trim().toLowerCase();
                if (command) {
                    const line = document.createElement('div');
                    line.className = 'terminal-line';
                    line.innerHTML = `<span class="terminal-prompt">user@protegio:~$</span> ${terminalInput.value}<br>`;
                    terminalOutput.appendChild(line);

                    if (command === 'clear') {
                        terminalOutput.innerHTML = '';
                    } else {
                        const output = document.createElement('div');
                        output.className = 'terminal-line';
                        output.textContent = terminalCommands[command] || `Command not found: ${command}`;
                        terminalOutput.appendChild(output);
                    }

                    terminalInput.value = '';
                    terminalOutput.scrollTop = terminalOutput.scrollHeight;
                }
            }
        });

        // Mobile menu close on link click
        document.querySelectorAll('.sidebar-nav-link').forEach(link => {
            link.addEventListener('click', () => {
                if (window.innerWidth < 576) {
                    sidebar?.classList.add('collapsed');
                }
            });
        });

        // Responsive sidebar
        window.addEventListener('resize', () => {
            if (window.innerWidth > 576) {
                sidebar?.classList.remove('collapsed');
            }
        });
    </script>
</body>
</html>
